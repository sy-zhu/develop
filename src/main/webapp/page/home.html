<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="pragma" content="no-cache">
<meta http-equiv="cache-control" content="no-cache">
<meta http-equiv="expires" content="0">
<meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
<meta http-equiv="description" content="导入excel">
<title>用户信息中心</title>

<link rel="import" href="/develop/static/comm.html" id="commplugin">
<script type="text/javascript" src="/develop/js/home.js"></script>
</head>
<body>
	<div class="panel panel-info panel1" style="border: 0px;">
		<div class="container-fluid" style="border: 0px;">
			<div class="panel-body" style="border: 0px;">
				<!-- *************************begin*************************8 -->
				<div class="row"
					style="margin-top: 0px; border: #ccc 1px solid; background: #DDDDD2;">
					<h3 class="panel-title" style="width: 120px; margin: 10px;">查询条件</h3>
				</div>

				<div class="row"
					style="border-bottom: 0px; border: #ccc 1px solid; height: 45px;">
					<label class="fc01" style="width: 87px; margin: 10px;">用户姓名</label>
					<input type="text" id="username" name="username" />


					<button type="button" class="btn btn-primary"
						style="margin-left: 630px;" id="queryUserInfoBtnId">
						<span class="glyphicon glyphicon-search">查询</span>
					</button>

				</div>

				<div class="row"
					style="margin-top: -1px; padding-left: 5px; padding: 5px;">
					<div class="col-xs-4">

						<div
							style="margin-left: 900px; m; margin-top: -84px; adding-top: 5px;">
							<button id="exportBtnId" class="btn btn-info btn-sm">导出</button>

							<button id="importBtnId" class="btn btn-info btn-sm"
								style="margin-left: 89px; margin-top: -53px;">导入</button>

						</div>

						<div style="margin-left: 1067px; margin-top: -37px;">
							<form id="from1"
								action="/develop/develop/excelRestController/improtExcel"
								method="post" enctype="multipart/form-data"
								style="margin-top: -47px;">
								<input type="file" id="uploadFile" name="file" />
							</form>
						</div>

					</div>
				</div>


			</div>
			<!-- *************************end*************************8 -->



			<!-- ***********************!!!三个控制面板 实现 start!!!***************************** -->
			<!-- 导航 -->

			<div>
				<ul class="nav nav-tabs" role="tablist">
					<li role="presentation" class="active"><a role="tab"
						data-toggle="tab" href="#personalInjuryIdentificationMsg1">用户信息展示</a>
					</li>

					<li role="presentation"><a role="tab" data-toggle="tab"
						href="#personalInjuryIdentificationMsg2">用户新增页面</a></li>

					<button type="button" class="btn btn-info btn-sm"
						style="margin-left: 685px;" id="editUserInfoBtnId">
						<span class="glyphicon">新增</span>
					</button>

					<button type="button" class="btn btn-info btn-sm"
						style="margin-left: 10px;" id="deleteUserInfoBtnId">
						<span class="glyphicon">删除已勾选</span>
					</button>

				</ul>
			</div>
			<div class="tab-content" style="border: 0px;">


				<!-- 面板1 -->
				<div role="tabpanel" class="tab-pane active" style="border: 0px;"
					id="personalInjuryIdentificationMsg1">

					<div class="panel panel-info panel1">
						<table id="userTableId"></table>
					</div>

				</div>

				<!-- 面板2 -->
				<div role="tabpanel" class="tab-pane" style="border: 0px;"
					id="personalInjuryIdentificationMsg2">

					<!-- 新增用户 start -->
					<div class="row"
						style="margin-top: -1px; border: #ccc 1px solid; padding-left: 5px; padding: 5px; margin: 0 auto;">

						<div class="col-xs-4"
							style="width: 25%; margin: 10px auto; margin-left: 319px;">
							<label class="fc01" style="width: 87px; margin: 10px;">用户姓名</label>
							<input type="text" id="addUsername" name="username" /> <label
								class="fc01" style="width: 87px; margin: 10px;">用户密码</label> <input
								type="text" id="addPwd" name="addPwd" /> <label class="fc01"
								style="width: 87px; margin: 10px;">用户年龄</label> <input
								type="text" id="addAge" name="addAge" />
						</div>

						<div class="col-xs-4" style="width: 25%; margin: 10px auto;">
							<label class="fc01" style="width: 87px; margin: 10px;">用户地址</label>
							<input type="text" id="addAddr" name="addAddr" /> <label
								class="fc01" style="width: 87px; margin: 10px;">邮箱</label> <input
								type="text" id="email" name="email" />

						</div>
					</div>


					<button type="button" class="btn btn-primary"
						style="margin-left: 445px; margin-top: 56px;"
						id="addUserInfoBtnId">
						<span class="glyphicon glyphicon-search">提交</span>
					</button>

					<button type="button" class="btn btn-primary"
						style="margin-left: 208px; margin-top: 52px;" id="resetAddUserMsg">
						<span class="glyphicon glyphicon-search">重置</span>
					</button>

					<!-- 新增用户 end -->


				</div>

			</div>

			<!-- ***********************!!!控制面板 实现  end!!!***************************** -->

		</div>
	</div>


	<!-- 编辑******************************begin -->


	<div class="modal fade" id="myModal" tabindex="-1" role="dialog"
		aria-labelledby="myModalLabel">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title" id="myModalLabel">新增</h4>
				</div>
				<div class="modal-body">
					<div class="form-group">
						<label for="addUsernameNew">姓名</label> <input type="text"
							name="addUsernameNew" class="form-control" id="addUsernameNew"
							placeholder="姓名">
					</div>
					<div class="form-group">
						<label for="addPwdNew">密码</label> <input type="text"
							name="addPwdNew" class="form-control" id="addPwdNew"
							placeholder="密码">
					</div>
					<div class="form-group">
						<label for="addAgeNew">年龄</label> <input type="text"
							name="addAgeNew" class="form-control" id="addAgeNew"
							placeholder="年龄">
					</div>
					<div class="form-group">
						<label for="addAddrNew">地址</label> <input type="text"
							name="addAddrNew" class="form-control" id="addAddrNew"
							placeholder="地址">
					</div>
					<div class="form-group">
						<label for="addEmailNew">邮箱</label> <input type="text"
							name="addEmailNew" class="form-control" id="addEmailNew"
							placeholder="邮箱">
					</div>

				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">
						<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>关闭
					</button>
					<button type="button" id="addUserInfoBtnId2"
						class="btn btn-primary" data-dismiss="modal">
						<span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>保存
					</button>
				</div>
			</div>
		</div>
	</div>
	<!-- 编辑******************************end -->
</body>


<script type="text/javascript">
$(function() {
	// -----------------------------------------------------------
	//弹框的样式修改
	toastr.options = {
		"closeButton" : false,//显示关闭按钮
		"debug" : false,//启用debug
		"positionClass" : "toast-top-center",//弹出的位置
		"showDuration" : "300",//显示的时间
		"hideDuration" : "1000",//消失的时间
		"timeOut" : "3000",//停留的时间
		"extendedTimeOut" : "1000",//控制时间
		"showEasing" : "swing",//显示时的动画缓冲方式
		"hideEasing" : "linear",//消失时的动画缓冲方式
		"showMethod" : "fadeIn",//显示时的动画方式
		"hideMethod" : "fadeOut"//消失时的动画方式
	};
	
/* 		$('.startDate').datetimepicker({
        language: 'zh-CN',//显示中文
        format: 'yyyy-mm-dd',//显示格式
        minView: "month",//设置只显示到月份
        initialDate: new Date(),
        autoclose: true,//选中自动关闭
        todayBtn: true,//显示今日按钮
        locale: moment.locale('zh-cn')
    }); */

	// -----------------------------------------------------------

	$("#exportBtnId")
			.click(
					function() {
						debugger;
						var username = $("#username").val();

						//方法一：导出 
						//exports();

						//方法二：导出
						//window.location.href="调用的路径?变量名="+值;
						window.location.href = "/develop/develop/excelRestController/exportExcel?username="+username;

					});

	$("#importBtnId").click(function() {
		importEmp();
	});
	$("#queryUserInfoBtnId").click(function() {
		showAllUserMsg();
	});
	
	//新增用户
	$("#addUserInfoBtnId").click(function() {
		var datas = {};
		
		datas.username=$("#addUsername").val();
		datas.pwd=$("#addPwd").val();
		datas.age=$("#addAge").val();
		datas.addr=$("#addAddr").val();
		datas.email=$("#email").val();
		
		addUserMsg(datas);
		
		 
	});
	
	//弹框新增
	$("#addUserInfoBtnId2").click(function() { 
		var datas = {};
		datas.username=$("#addUsernameNew").val();
		datas.pwd=$("#addPwdNew").val();
		datas.age=$("#addAgeNew").val();
		datas.addr=$("#addAddrNew").val();
		datas.email=$("#emailNew").val();
		 
		 if(typeof(datas.username) == 'undefined' ||datas.username == '') {
             toastr.warning('姓名必填');
             return false;
         } 
		 
		addUserMsg(datas); 
		
		 $("#addUsernameNew").val("");
		 $("#addPwdNew").val("");
		 $("#addAgeNew").val("");
		 $("#addAddrNew").val("");
		 $("#emailNew").val("");
		  
	});
	
	//重置新增用户
	$("#resetAddUserMsg").click(function() {
		resetAddUserMsg();
	});

	showAllUserMsg();
});


	
function showUserInfoTable(datas){
	$("#userTableId").bootstrapTable('destroy'); 
	
	$("#userTableId").bootstrapTable('resetView', {
        height: $(window).height() - 100
    });
    
    
    var $table = $('#userTableId');
    $table.bootstrapTable({
        class: 'table table-hover letable-bordered',
        contentType: 'application/x-www-form-urlencoded; charset=utf-8',
        data: datas,
       // url: '/develop/develop/userMsgRestController/findUsers',         //请求后台的URL（*）
     //   method: 'post',                      //请求方式（*）
        queryParamsType:'',
        sidePagination: "client",           //分页方式：client客户端分页，server服务端分页（*）
		dataType:'json', 
		data_locale:"zh-US",  //转换中文 但是没有什么用处
        pagination: true,
        pageNumber:1,
        height:418,
        pageSize:8,//每页显示的数量
        paginationPreText:"上一页",
        paginationNextText:"下一页",
        paginationLoop:false,
        striped: true,                      //是否显示行间隔色
        pageList: [8,16,24,48],
        buttonsToolbar:'#buttons' ,
       // search: true, //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大
        queryParams: function queryParams(params) {
            var param = {  
                pageNumber: params.pageNumber,    
                pageSize: params.pageSize,
                username:$("#username").val()
            }; 
            for(var key in searchArgs){
                param[key]=searchArgs[key]
            }  
            return param;                   
          },  
/* 	         
*   	控制某个特殊行的颜色
*   */
			rowStyle: function (row, index) {
                //这里有5个取值代表5中颜色['active', 'success', 'info', 'warning', 'danger'];
                var strclass = "";
                if (row.username == "张三") {
                    strclass = 'active';//还有一个active
                }
                else if (row.username == "tom") {
                    strclass = 'success';
                }
                else if (row.username == "赵六") {
                    strclass = 'info';
                }
                else if (row.username == "shel") {
                    strclass = 'warning';
                }
                else if (row.username == "helloKitty") {
                    strclass = 'danger';
                }
                else {
                    return {};
                    
                    // or 
                    //strclass = 'warning'
                }
                return { classes: strclass }
            },
          
        columns: [
        	{
		        field: 'ischeck',
		        title: 'check ID',
		        checkbox : true,
		        width: '5%',
		    },
            {
                field: 'id',
                width: '10%',
                title: '个人编号',
                align: 'center',
                visible:false
            },
        	{
                field: 'username',
                width: '10%',
                title: '姓名',
                align: 'center'
            },
            {
                field: 'pwd',
                width: "10%",
                title: '密码' ,
                align: 'center'
            },
            {
                field: 'rolename',
                width: "10%",
                title: '角色类型' ,
                align: 'center'
            },
            {
                field: 'age',
                width: "10%",
                title: '年龄' ,
                align: 'center'
            } ,
        	{
                field: 'addr',
                width: '10%',
                title: '地址',
                align: 'center'
            },
        	{
                field: 'email',
                width: '10%',
                title: '邮箱',
                align: 'center'
            }
        ]
    });
} 
$("#editUserInfoBtnId").click(function(){ 
	 $("#myModalLabel").text("新增");
	  $('#myModal').modal(); 
});



/**
 * 导出
 * @returns
 */
function exports() {
	$.ajax({
		url : "/develop/develop/excelRestController/exportExcel",
		data : {},
		contenttype : "application/x-www-form-urlencoded;charset=utf-8",
		type : "POST",
		dataType : "text",
		success : function(restbody) {
			toastr.success("导出成功");
		}
	});
}

/**
 * 查询用户数据-用于列表展示
 * @returns
 */
function showAllUserMsg() {
	var name=$("#username").val();
	$.ajax({
		url : "/develop/develop/userMsgRestController/findUsers",
		data : {username:name},
		contenttype : "application/x-www-form-urlencoded;charset=utf-8",
		type : "POST",
		dataType : "json",
		success : function(restbody) {
			showUserInfoTable(restbody);
		}
	});
}

//Excel文件导入到数据库中     
function importEmp() {
	var uploadFile = $("#uploadFile").val();
	if (uploadFile == null || uploadFile == '') {
		alert("请选择要上传的Excel文件");
		return;
	} else {
		var fileExtend = uploadFile.substring(uploadFile.lastIndexOf('.'))
				.toLowerCase();
		if (fileExtend == '.xls') {
		} else {
			alert("文件格式需为'.xls'格式");
			return;
		}
	}

	//var url = "/develop/develop/excelRestController/improtExcel";
	var url = "/develop/develop/testforexcel/improtExcel";
	var formData = new FormData($('form')[0]);
	sendAjaxRequest(url, "POST", formData);

}

function sendAjaxRequest(url, type, data) {
	$.ajax({
		url : url,
		type : type,
		data : data,
		dataType : "json",
		success : function(result) {

			toastr.success("导入成功");

		},
		error : function(result) {

			toastr.success('提交数据失败');

		},
		cache : false,
		contentType : false,
		processData : false
	});
};

 /* 删除 选中的用户*/
$("#deleteUserInfoBtnId").click(function(){ 
	
	 var selectContent =$("#userTableId").bootstrapTable('getSelections');
 
	 if(typeof(selectContent) == 'undefined' ||selectContent == '') {
         toastr.warning('请选择一列数据!');
         return false;
     } 
	 var tempUserInfos=JSON.stringify(selectContent);  
	   
/*var obj = JSON.parse(tempUserInfos);
		 
 var userIds = "";
	 for(var i =0;i<obj.length;i++)
	 {
		 userIds=userIds+obj[i].id;
		 
		 if(i != obj.length -1)
		 {
			 userIds=userIds+",";
		 } 
		 
	 }  */
	  
	 $.ajax({
            url: "/develop/develop/userMsgRestController/deleteUser",
            data: {"userIds":tempUserInfos},  
            type: 'POST',
            contenttype : "application/x-www-form-urlencoded;charset=utf-8",
            dateType : "json",
            success: function(restbody) {
            	if(restbody.code == 1) {
            		toastr.success("删除成功");	
            	}else {
            		toastr.info("删除异常，请稍后再试");
            	}
            	showAllUserMsg();  
            }
       });
	 
});

 


//重置新增用户
function resetAddUserMsg()
{
	
	 $("#addUsername").val("");
	 $("#addPwd").val("");
	 $("#addAge").val("");
	 $("#addAddr").val("");
	 $("#email").val("");
	 
}



//新增用户
function addUserMsg(datas)
{  

	
	$.ajax({
		url : "/develop/develop/userMsgRestController/addUser",
		data : datas,
		contenttype : "application/x-www-form-urlencoded;charset=utf-8",
		type : "POST",
		dataType : "json",
		success : function(restbody) {
			 var code = restbody.code;
			 if(code == -1)
			 {
				toastr.info(restbody.body);	 
			 }else
			 {
				toastr.success(restbody.body);		
				resetAddUserMsg();
			 } 
			 showAllUserMsg();
		}
	});
	
	
}

</script>
</html>